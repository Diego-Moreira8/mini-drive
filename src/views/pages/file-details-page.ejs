<div class="fileDetailsPage">
  <h2><%= locals.file.fileName %></h2>
  
  <p>
    <b>Tamanho: </b>
    <%= parseFloat((locals.file.size / 1e6).toFixed(2)) %> MB
  </p>
  
  <p>
    <b>Proprietário: </b>
    <%=
      locals.file.ownerId === locals.user.id
       ? "Você mesmo"
       : locals.file.owner.name
          ? `${locals.file.owner.name} (${locals.file.owner.username})`
          : locals.file.owner.username
    %>
  </p>
  
  <div class="options">
    <a 
      href="<%= `/arquivo/${locals.file.id}/baixar` %>"
      class="button ok"
    >
      Baixar
    </a>

    <a 
      href="<%= `/arquivo/${locals.file.id}/apagar` %>"
      class="button"
    >
      Apagar
    </a>
    
    <a 
      href="<%= `/arquivo/${locals.file.id}/renomear` %>"
      class="button"
    >
      Renomear
    </a>
    
    <a 
      href="<%= `/arquivo/${locals.file.id}/compartilhar` %>"
      class="button"
    >
      <%= locals.file.shareCode ? "Parar de compartilhar" : "Compartilhar" %>
    </a>

    <% if (locals.file.shareCode) { %>
      <button 
        type="button"
        id="copyUrl"
        data-share-code="<%= locals.file.shareCode %>"
      >
        Copiar link para compartilhamento
      </button>
    <% } %>
  </div>
  
  <a href="<%= `/pasta/${locals.file.folderId}` %>" class="blockLeft">
    Ir para a pasta do arquivo
  </a>
</div>

<script>
  document
    .querySelector("#copyUrl")
    .addEventListener("click", (e) => {
      navigator.permissions
        .query({name: "clipboard-write"})
        .then(result => {
          if (result.state === "granted" || result.state === "prompt") {
            navigator.clipboard.writeText(
              window.location.origin + 
              "/s/" + 
              e.target.getAttribute("data-share-code")
            )
          } else if (result.state === "denied") {
            alert(`
              Não foi possível copiar o código. Verifique se foi concedida 
              permissão de acesso a área de transferência no seu navegador.
            `)
          }
        })
    })
</script>